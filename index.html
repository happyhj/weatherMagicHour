<!DOCTYPE html>
<html>
<head>
		<meta charset="utf-8" />
<script src="js/noBounce.js" type="text/javascript"></script>
<script type="text/javascript">
	noBounce.init({preventDefault: true, animate: true}); 
</script>
<!-- Not letterboxed on iPhone 5 -->
<meta name="viewport"
  content="initial-scale=1.0">
<meta name="viewport"
  content="width=320.1, user-scalable=no">  
<!-- Changing the Status Bar Appearance -->
<meta name="apple-mobile-web-app-status-bar-style" content="translucent black" />
<!-- Hiding Safari User Interface Components -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="stylesheet" type="text/css" href="css/reset.css" />

<!-- jQuery 1.10.1 : Start -->
<script src="js/jquery.min.js"></script>
<!-- jQuery 1.10.1 : End -->
<script src="js/modernizr.custom.js"></script>

<link rel="stylesheet" type="text/css" href="css/style.css" />
<title>Magic Hour</title>
<script type="text/javascript" src="js/iscroll.js"></script>
</head>
<body onload="loaded()">

<div id="nav">
	<div id="today_full_date" class="full_date"><span>오늘 날짜 길게</span>
		<p>TODAY</p>
	</div>
	<div id="today_compact_date" class="compact_date">오날
	</div>
	<div id="tomorrow_full_date" class="full_date"><span>내일 날짜 길게</span>
		<p>TOMORROW</p>
	</div>
	<div id="tomorrow_compact_date" class="compact_date">내날
	</div>
	<div id="alarm_full_menu" class="full_date">
		<img src="img/alarm.png" />
	</div>
	<div id="alarm_compact_menu" class="compact_date">
		<img src="img/alarm.png" />
	</div>
</div>

<div id="indicator">
	<div id="dotty"><div id="dotty_shade"></div></div>
</div>

<div id="viewport">
	<div id="wrapper">
		<div id="scroller">
					<div class="slide" id="todayPage">
						<div class="touch-container">
							<div class="mg-container">
								<div class="upcoming_magichour_label">Upcoming Magic Hour</div>
								<div class="sun-img-container"/>
									<img src="img/sunrise.png" class="touchPad0" id="tdy_sunrise_img"/>
								</div>
								<p class="touchPad0">12:00 - 12:30 - 13:00</p>
							</div>
							<div class="mg-container">
								<div class="upcoming_magichour_label">Upcoming Magic Hour</div>
								<div class="sun-img-container"/>
									<img src="img/sunset.png" class="touchPad0" id="tdy_sunset_img"/>
								</div>
								<p class="touchPad0">12:00 - 12:30 - 13:00</p>
							</div>	
							<div class="mgblank-container">
								<p>오늘의 매직아워는 마감되었습니다.</p>
							</div>
						</div>	
						<div class="flipper card-container">  
						 	<div class="card" data-direction="top">
						 		<div class="front">
							 		<p class="weather_container_title">Currently</p>
						 			<p class="weatherInfo_border_container left">
						 			</p>
						 			<p class="weatherInfo_border_container right">
						 			</p>
						 			<div class="weatherInfo_container">
							 			<img src="img/eye.png"/>
							 			<p>9.9km</p>
						 			</div>
						 			<div class="weatherInfo_container">
							 			<span class="icon">A</span>
							 			<p class="weather_description label">sss</p>
							 			<p class="weather_description placeholder">s</p>
						 			</div>
						 			<div class="weatherInfo_container">
							 			<img class="cloud_cover_img" src="img/cloudCover0.png"/>
							 			<p class="cloud_cover_value">17%</p>
						 			</div>
							 		<input type="button" id="fBtn0" value="click me" class="cbutton" />
						 		</div>
						 		<div class="back">
						 			<h1 style="text-align:center">터치한시각의날씨1</h1>
						 			<input type="button" id="bBtn0" value="OK" class="cbutton" />
						 		</div>
						 	</div>							
						</div>				
					</div>
					<div class="slide" id="tomorrowPage">
						<div class="touch-container" id="touchPad1">
							<div class="mg-container">
								<div class="upcoming_magichour_label">Upcoming Magic Hour</div>
								<div class="sun-img-container"/>
									<img src="img/sunrise.png" class="touchPad1" id="tdy_sunrise_img"/>
								</div>
								<p class="touchPad1">12:00 - 12:30 - 13:00</p>
							</div>
							<div class="mg-container">
								<div class="upcoming_magichour_label">Upcoming Magic Hour</div>
								<div class="sun-img-container"/>
									<img src="img/sunset.png" class="touchPad1" id="tdy_sunset_img"/>
								</div>
								<p class="touchPad1">12:00 - 12:30 - 13:00</p>
							</div>	
						</div>
						<div class="flipper card-container">  
						 	<div class="card" data-direction="top">
						 		<div class="front">
							 		<p class="weather_container_title">Tomorrow</p>
						 			<p class="weatherInfo_border_container left">
						 			</p>
						 			<p class="weatherInfo_border_container right">
						 			</p>
						 			<div class="weatherInfo_border_container">
						 			</div>
						 			<div class="weatherInfo_container">
							 			<img src="img/umbrella.png"/>
							 			<p>0%</p>
						 			</div>
						 			<div class="weatherInfo_container">
							 			<span class="icon">A</span>
							 			<p class="weather_description label">sss</p>
							 			<p class="weather_description placeholder">s</p>
						 			</div>
						 			<div class="weatherInfo_container">
							 			<img class="cloud_cover_img" src="img/cloudCover0.png"/>
							 			<p class="cloud_cover_value">17%</p>
						 			</div>
							 		<input type="button" id="fBtn1" value="click me" class="cbutton" />
						 		</div>
						 		<div class="back">
						 			<h1 style="text-align:center">터치한시각의날씨2</h1>
						 			<input type="button" id="bBtn1" value="OK" class="cbutton" />
						 		</div>
						 	</div>							
						</div>				
					</div>
					<div class="slide" id="alarmPage">
						<div>3sdfsd</div>
					</div>
		</div>
	</div>

</div>

<script type="text/javascript">

// 메뉴구조를 이루는 iScroll 객체 
var myScroll;

function loaded () {
	// carousel 메뉴 구조 초기화
	myScroll = new IScroll('#wrapper', {
		scrollX: true,
		scrollY: false,
		momentum: false,
		snap: true,
		click: true,
		snapSpeed: 400,
		keyBindings: true,
		indicators: {
			el: document.getElementById('indicator'),
			resize: false
		}
	});

	// carousel 페이지 스크롤 완료시, 메뉴효과발생  
	var menuTitleTransformMillisec = 300;
	myScroll.on('scrollEnd', function () { 
		switch(this.currentPage.pageX) {
			case 0:	
				$("#today_full_date").css("display","block");
				
				$("#today_full_date").animate({opacity:"1"},menuTitleTransformMillisec);
				$("#tomorrow_full_date").animate({opacity:"0"},menuTitleTransformMillisec);
				$("#alarm_full_menu").animate({opacity:"0"},menuTitleTransformMillisec);

				$("#tomorrow_full_date").css("display","none");
				$("#alarm_full_menu").css("display","none");
	
				
				$("#today_compact_date").animate({opacity:"0"},menuTitleTransformMillisec);				
				$("#tomorrow_compact_date").animate({opacity:"1",left:"62%"},menuTitleTransformMillisec);
				$("#alarm_compact_menu").animate({opacity:"1"},menuTitleTransformMillisec);
				

			break;
			case 1:
				$("#tomorrow_full_date").css("display","block");

				$("#today_full_date").animate({opacity:"0"},menuTitleTransformMillisec);
				$("#tomorrow_full_date").animate({opacity:"1"},menuTitleTransformMillisec);
				$("#alarm_full_menu").animate({opacity:"0"},menuTitleTransformMillisec);					

				$("#today_full_date").css("display","none");
				$("#alarm_full_menu").css("display","none");

				$("#today_compact_date").animate({opacity:"1"},menuTitleTransformMillisec);
				$("#tomorrow_compact_date").animate({opacity:"0"},menuTitleTransformMillisec);
				$("#alarm_compact_menu").animate({opacity:"1"},menuTitleTransformMillisec);
			break;
			case 2:
				$("#alarm_full_menu").css("display","block");

				$("#today_full_date").animate({opacity:"0"},menuTitleTransformMillisec);
				$("#tomorrow_full_date").animate({opacity:"0"},menuTitleTransformMillisec);
				$("#alarm_full_menu").animate({opacity:"1"},menuTitleTransformMillisec);

				$("#today_full_date").css("display","none");
				$("#tomorrow_full_date").css("display","none");

				$("#today_compact_date").animate({opacity:"1"},menuTitleTransformMillisec);
				$("#tomorrow_compact_date").animate({opacity:"1",left:"19%"},menuTitleTransformMillisec);
				$("#alarm_compact_menu").animate({opacity:"0"},menuTitleTransformMillisec);								
			break;			
		}
	});
	// 다른페이지로 스크롤 시작 시 확장된 디테일 modal 접기	
	myScroll.on('scrollStart', function () { 
		
	});
}

</script>
<link rel="stylesheet" type="text/css" href="css/flipCard.css" />		
<style type="text/css">
	div.touch-container {
		position: relative;
		width: 100%;
		height: 80%;								
	} 	
	.card-container .card>div{
		background-color: transparent;
	}
	p.weatherInfo_border_container {
		position: absolute;
		top: 0px;
		height: 0px;
		width:100%;
		border-top: 1px solid rgba(255,255,255,0.6);		
	}
	p.weatherInfo_border_container.right{
		right: 0px;
	}
	p.weatherInfo_border_container.left{
		left: 0px;
		width: 15px;
	}
	div.card-container {
		position: relative;
		bottom: 0px;
		left:0px;
		width: 100%;
		height: 120px;	
		z-index: -1;
	}
	div.card input {
		display: none;
	}
	div.card h1 {
		color: white;
	}
	div.mg-container {
		position: relative;
		height: 40%;
		text-align: center;
		padding-top: 60px;
		padding-bottom: 0px;
		z-index: 5;
	}
	

	div.mgblank-container {
		position: absolute;
		height: 100%;
		width: 100%;
		text-align: center;		
	}
	div.mgblank-container p{
		position: relative;
	
		height: 200px;
		width: 200px;
		top:50%;
		
		left:50%;
		margin-left: -100px;
		margin-top: -100px;
		
		border-radius: 100px;
		text-align: center;
		background-color: rgba(0,0,0,0.4);

		padding: 25px;
		padding-top:75px;
		font-family: 'Roboto', sans-serif;
		font-weight: 600;
		color: white;
		font-size: 20px;
		
	}
	div.sun-img-container {
		position: relative;
		width: 100%;
		padding-bottom:1%;
		text-align: center;
	}
	
	div.mg-container img {
		height:30%;
	}
	div.mg-container p {
		font-family: 'Roboto', sans-serif;
		font-weight: 300;
		color: white;
		font-size: 36px;
	}
	
	div.weatherInfo_container p.weather_description.label{
		position: absolute;
		text-align: center;
		width:130%;
		left:-15%;
		margin-top: 6px;
		line-height: 12px;
	}
	
	div.weatherInfo_container p.weather_description.placeholder {
		visibility: hidden;
		color: fuchsia;
	}
	
	div.upcoming_magichour_label {
		position: absolute;
		width:100%;
		top:5px;
		font-family: 'Roboto', sans-serif;
		font-weight: 200;
		color: white;
		font-size: 18px;	
		text-align: center;	
	}
		
</style>

<script src="js/flipCard.js"></script>
<script type="text/javascript">
var navHeight = 120;
var weatherInfoHeight = 120;

var isSunriseFocused = false;
var isSunsetFocused = false;

$(document).ready(function() {

	// 네비게이션 터치시 해당 페이지로 이동되는 이벤트 바인딩
	$("#today_compact_date").bind( "touchend", function() {
		myScroll.scrollTo(0,0,300);
		
		if(myScroll.currentPage.pageX==0){
			$("#today_full_date").animate({opacity:"0"},300);
		} else if(myScroll.currentPage.pageX==1) {
			$("#tomorrow_full_date").animate({opacity:"0"},300);
		}	else if(myScroll.currentPage.pageX==2) {
			$("#alarm_full_menu").animate({opacity:"0"},300);
		}
		
		myScroll.currentPage.pageX=0;

	});
	$("#tomorrow_compact_date").bind( "touchend", function() {
		myScroll.scrollToElement(document.querySelector('#tomorrowPage'),300);
		
		if(myScroll.currentPage.pageX==0){
			$("#today_full_date").animate({opacity:"0"},300);
		} else if(myScroll.currentPage.pageX==1) {
			$("#tomorrow_full_date").animate({opacity:"0"},300);
		}	else if(myScroll.currentPage.pageX==2) {
			$("#alarm_full_menu").animate({opacity:"0"},300);
		}
		
		myScroll.currentPage.pageX=1;
	});			
	$("#alarm_compact_menu").bind( "touchend", function() {
		myScroll.scrollToElement(document.querySelector('#alarmPage'),300);

		if(myScroll.currentPage.pageX==0){
			$("#today_full_date").animate({opacity:"0"},300);
		} else if(myScroll.currentPage.pageX==1) {
			$("#tomorrow_full_date").animate({opacity:"0"},300);
		}	else if(myScroll.currentPage.pageX==2) {
			$("#alarm_full_menu").animate({opacity:"0"},300);
		}
		
		myScroll.currentPage.pageX=2;
	});
	
	// iscroll Nav부분 display상태 초기화
	$("#today_full_date").css("opacity","1");
	$("#tomorrow_full_date").css("opacity","0");
	$("#alarm_full_menu").css("opacity","0");
	
	$("#today_compact_date").css("opacity","0");
	$("#tomorrow_compact_date").css("opacity","0");
	$("#alarm_compact_menu").css("opacity","1");
	$("#tomorrow_full_date").css("display","none");
	$("#alarm_full_menu").css("display","none");


		// 일출 터치 시 세부정보 modal로 toggle  
		$(".mg-container:nth-child(1) img,.mg-container:nth-child(1) p").bind("tap mouseup", function(){
			if(isSunriseFocused===false) {
				$("div.card-container").animate({opacity:0},400);
				$(".mg-container:nth-child(2)").css("visibility","hidden");
				$(".mg-container:nth-child(2)").css("opacity","0");

				$(".mg-container:nth-child(1) img").animate({width:"100px",height:"80px"},400);
				$(".mg-container:nth-child(1) p").animate({fontSize: "36px"},400);
				
				myScroll.disable();		

				isSunriseFocused = true;
			} else {
				$("div.card-container").animate({opacity:1},400);		
				$(".mg-container:nth-child(2)").css("visibility","visible");
				$(".mg-container:nth-child(2)").animate({opacity:"1"},400);
				
				$(".mg-container:nth-child(1) img").animate({width:"70px",height:"56px"},400);
				$(".mg-container:nth-child(1) p").animate({fontSize: "24px"},400);	
				myScroll.enable();

				isSunriseFocused = false;			
			}
		});
		// 일몰 터치 시 세부정보 modal로 toggle  
		$(".mg-container:nth-child(2) img,.mg-container:nth-child(2) p").bind("tap mouseup", function(){
			if(isSunsetFocused===false) {
				$("div.card-container").animate({opacity:0},400);
				$(".mg-container:nth-child(1)").css("visibility","hidden");
				$(".mg-container:nth-child(1)").css("opacity","0");

				$(".mg-container:nth-child(2)").animate({top:"-156px"},400);
	
				$(".mg-container:nth-child(2) img").animate({width:"100px",height:"80px"},400);
				$(".mg-container:nth-child(2) p").animate({fontSize: "36px"},400);
	
				myScroll.disable();	
				
				isSunsetFocused = true;
			} else {
				$("div.card-container").animate({opacity:1},400);				
				$(".mg-container:nth-child(1)").css("visibility","visible");
				$(".mg-container:nth-child(1)").animate({opacity:"1"},400);
				
				var myForecastData = JSON.parse(localStorage.getItem('myForecastData'));

				if (Object.keys(myForecastData['today']).length==3) {
					$("#todayPage .mg-container:nth-child(1)").css("visibility","hidden");
				}			

				$(".mg-container:nth-child(2)").animate({top:"0px"},400);
	
				$(".mg-container:nth-child(2) img").animate({width:"70px",height:"56px"},400);
				$(".mg-container:nth-child(2) p").animate({fontSize: "24px"},400);
				myScroll.enable();

				isSunsetFocused = false;			
			}
		});

		getLocation();
		resizeObjects();
});

// 창 크기가 변하면 이벤트 발생
$(window).resize(function() {
	resizeObjects();
});
function updateUpcomingLabel() {
	$.each($("div.mg-container"),function() {
		$("div.upcoming_magichour_label",this).css("visibility","hidden");
	});
	$.each($("div.mg-container"),function() {
		if($(this).css("visibility")!="hidden") {
			$("div.upcoming_magichour_label",this).css("visibility","visible");
			return false;			
		}
	});
} 
function resizeObjects() {
	// 화면크기에 따라 iscroll 크기 조절 
	$("#wrapper").css("width",String($(window).width())+"px");
	$(".slide").css("width",String($(window).width())+"px");
	$("#scroller").css("width",String($(window).width()*3)+"px");

	$("#wrapper").css("height",String($(window).height()-navHeight)+"px");
	$(".slide").css("height",String($(window).height()-navHeight)+"px");
	$("#scroller").css("height",String($(window).height()-navHeight)+"px");
	$("#viewport").css("height",String($(window).height()-navHeight)+"px");
	
	$("div.touch-container").css("height",String($(window).height()-navHeight-weatherInfoHeight)+"px");
	
	// 창 너비 - .weather_container_title 의 너비
	$("div#todayPage p.weatherInfo_border_container.right").css("width",($(window).width()-95)+"px");
	$("div#tomorrowPage p.weatherInfo_border_container.right").css("width",($(window).width()-105)+"px");	
	
	// 일출 일몰 시간 위치
	$("div.slide div.mg-container").css("height",$("div.slide>div.touch-container").height()*0.5+"px");
	$("div.slide div.mg-container:nth-child(1)").css("padding-top",$("div.slide>div.touch-container").height()*0.15+"px");
	$("div.slide div.mg-container:nth-child(2)").css("padding-top",$("div.slide>div.touch-container").height()*0.09+"px");
}

</script>
<script type="text/javascript" src="js/weather.js"></script>
</body>
</html>